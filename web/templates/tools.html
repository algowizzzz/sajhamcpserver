{% extends "base.html" %}
{% block title %}Tools API - MCP Server{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="bi bi-tools"></i> Tools API & Configuration</h2>
    <div>
        <button class="btn btn-success" onclick="refreshPage()">
            <i class="bi bi-arrow-clockwise"></i> Refresh
        </button>
        <button class="btn btn-info" onclick="exportToJSON()">
            <i class="bi bi-download"></i> Export JSON
        </button>
        {% if 'admin' in session.user.roles %}
        <button class="btn btn-warning" onclick="reloadAllTools()">
            <i class="bi bi-bootstrap-reboot"></i> Reload All
        </button>
        {% endif %}
    </div>
</div>

<!-- Summary Cards -->
<div class="row mb-4">
    <div class="col-md-4">
        <div class="card stat-card text-white bg-primary">
            <div class="card-body">
                <h5 class="card-title">
                    <i class="bi bi-tools"></i> Total Tools
                </h5>
                <h2 class="mb-0">{{ tool_details|length }}</h2>
                <small>Available in Registry</small>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card stat-card text-white bg-success">
            <div class="card-body">
                <h5 class="card-title">
                    <i class="bi bi-plug"></i> Active Tools
                </h5>
                <h2 class="mb-0">{{ tool_details|length }}</h2>
                <small>Currently Loaded</small>
            </div>
        </div>
    </div>
    <div class="col-md-4">
        <div class="card stat-card text-white bg-info">
            <div class="card-body">
                <h5 class="card-title">
                    <i class="bi bi-bar-chart"></i> Total Calls
                </h5>
                <h2 class="mb-0">{{ stats.global_call_count }}</h2>
                <small>Across All Tools</small>
            </div>
        </div>
    </div>
</div>

<!-- Tools Configuration Table -->
<div class="card">
    <div class="card-header bg-secondary text-white d-flex justify-content-between align-items-center">
        <h4 class="mb-0"><i class="bi bi-table"></i> Tools Configuration</h4>
        <div>
            <button class="btn btn-sm btn-light" onclick="toggleAllDetails()">
                <i class="bi bi-arrows-expand"></i> Expand All
            </button>
            <button class="btn btn-sm btn-light" onclick="copyTableToClipboard()">
                <i class="bi bi-clipboard"></i> Copy Table
            </button>
        </div>
    </div>
    <div class="card-body">
        <!-- Table Controls -->
        <div class="row mb-3">
            <div class="col-md-4">
                <div class="d-flex align-items-center">
                    <label class="me-2 mb-0" style="white-space: nowrap;">Show</label>
                    <select id="rowsPerPage" class="form-select form-select-sm" style="width: auto;">
                        <option value="10">10</option>
                        <option value="25">25</option>
                        <option value="50" selected>50</option>
                        <option value="100">100</option>
                        <option value="all">All</option>
                    </select>
                    <label class="ms-2 mb-0" style="white-space: nowrap;">entries</label>
                </div>
            </div>
            <div class="col-md-8">
                <div class="input-group input-group-sm">
                    <span class="input-group-text">
                        <i class="bi bi-search"></i>
                    </span>
                    <input type="text" 
                           id="toolSearch" 
                           class="form-control" 
                           placeholder="Filter by name, module, or any field...">
                    <button class="btn btn-outline-secondary" 
                            type="button" 
                            onclick="clearSearch()">
                        <i class="bi bi-x-circle"></i> Clear
                    </button>
                </div>
            </div>
        </div>

        <!-- Tools Table -->
        <div class="table-responsive">
            <table class="table table-bordered table-hover" id="toolsTable">
                <thead class="table-light">
                    <tr>
                        <th style="cursor: pointer; width: 5%;" onclick="sortTable(0)">
                            <i class="bi bi-chevron-expand"></i>
                        </th>
                        <th style="cursor: pointer; width: 20%;" onclick="sortTable(1)">
                            Tool Name <i class="bi bi-arrow-down-up"></i>
                        </th>
                        <th style="cursor: pointer; width: 35%;" onclick="sortTable(2)">
                            Module <i class="bi bi-arrow-down-up"></i>
                        </th>
                        <th style="cursor: pointer; width: 15%;" onclick="sortTable(3)">
                            Max Hits <i class="bi bi-arrow-down-up"></i>
                        </th>
                        <th style="cursor: pointer; width: 15%;" onclick="sortTable(4)">
                            Interval (s) <i class="bi bi-arrow-down-up"></i>
                        </th>
                        <th style="width: 10%;">Actions</th>
                    </tr>
                </thead>
                <tbody id="toolsTableBody">
                    {% for tool in tool_details %}
                    <tr class="tool-row" 
                        data-tool-name="{{ tool.name|lower }}" 
                        data-module="{{ tool.module|lower }}"
                        data-search-text="{{ (tool.name + ' ' + tool.module + ' ' + tool.max_hits|string + ' ' + tool.max_hit_interval|string)|lower }}">
                        <td class="text-center">
                            <button class="btn btn-sm btn-outline-secondary expand-btn" 
                                    onclick="toggleDetails(this)"
                                    title="Show Configuration Details">
                                <i class="bi bi-chevron-down"></i>
                            </button>
                        </td>
                        <td>
                            <i class="bi bi-plugin text-primary"></i> 
                            <strong>{{ tool.name }}</strong>
                        </td>
                        <td>
                            <small class="font-monospace text-muted">{{ tool.module }}</small>
                        </td>
                        <td data-sort-value="{{ tool.max_hits }}">
                            <span class="badge bg-info">{{ tool.max_hits }}</span>
                        </td>
                        <td data-sort-value="{{ tool.max_hit_interval }}">
                            <span class="badge bg-warning text-dark">{{ tool.max_hit_interval }}s</span>
                        </td>
                        <td>
                            <div class="btn-group btn-group-sm" role="group">
                                <a href="{{ url_for('tool_detail', tool_name=tool.name) }}" 
                                   class="btn btn-primary btn-sm"
                                   title="View Details">
                                    <i class="bi bi-eye"></i>
                                </a>
                                <button class="btn btn-success btn-sm" 
                                        onclick="showAPIInfo('{{ tool.name }}')"
                                        title="API Info">
                                    <i class="bi bi-code-square"></i>
                                </button>
                            </div>
                        </td>
                    </tr>
                    <tr class="details-row" style="display: none;">
                        <td colspan="6" class="bg-light">
                            <div class="p-3">
                                <h6 class="mb-3"><i class="bi bi-gear"></i> Full Configuration</h6>
                                <div class="row">
                                    <div class="col-md-6">
                                        <table class="table table-sm table-borderless">
                                            <tr>
                                                <td class="text-muted" style="width: 40%;">Name:</td>
                                                <td><code>{{ tool.name }}</code></td>
                                            </tr>
                                            <tr>
                                                <td class="text-muted">Module:</td>
                                                <td><code>{{ tool.module }}</code></td>
                                            </tr>
                                        </table>
                                    </div>
                                    <div class="col-md-6">
                                        <table class="table table-sm table-borderless">
                                            <tr>
                                                <td class="text-muted" style="width: 40%;">Max Hits:</td>
                                                <td><code>{{ tool.max_hits }}</code></td>
                                            </tr>
                                            <tr>
                                                <td class="text-muted">Max Hit Interval:</td>
                                                <td><code>{{ tool.max_hit_interval }} seconds</code></td>
                                            </tr>
                                        </table>
                                    </div>
                                </div>
                                <div class="mt-2">
                                    <strong class="text-muted">JSON Configuration:</strong>
                                    <pre class="bg-white border rounded p-2 mt-1"><code class="language-json">{{ tool|tojson(indent=2) }}</code></pre>
                                </div>
                                <div class="mt-2">
                                    <button class="btn btn-sm btn-outline-primary" onclick="copyConfig('{{ tool.name }}')">
                                        <i class="bi bi-clipboard"></i> Copy JSON
                                    </button>
                                    <button class="btn btn-sm btn-outline-info" onclick="downloadConfig('{{ tool.name }}')">
                                        <i class="bi bi-download"></i> Download
                                    </button>
                                </div>
                            </div>
                        </td>
                    </tr>
                    {% endfor %}
                </tbody>
            </table>
        </div>

        <!-- Table Info and Pagination -->
        <div class="row mt-3">
            <div class="col-md-6">
                <div class="dataTables_info" id="tableInfo">
                    Showing <span id="showingStart">1</span> to <span id="showingEnd">10</span> 
                    of <span id="totalEntries">{{ tool_details|length }}</span> entries
                    <span id="filteredInfo" style="display: none;">
                        (filtered from <span id="totalTools">{{ tool_details|length }}</span> total entries)
                    </span>
                </div>
            </div>
            <div class="col-md-6">
                <nav aria-label="Table pagination">
                    <ul class="pagination pagination-sm justify-content-end mb-0" id="pagination">
                        <!-- Pagination will be generated by JavaScript -->
                    </ul>
                </nav>
            </div>
        </div>
    </div>
</div>

<!-- API Information Modal -->
<div class="modal fade" id="apiInfoModal" tabindex="-1">
    <div class="modal-dialog modal-lg">
        <div class="modal-content">
            <div class="modal-header bg-primary text-white">
                <h5 class="modal-title">
                    <i class="bi bi-code-square"></i> API Information: <span id="apiToolName"></span>
                </h5>
                <button type="button" class="btn-close btn-close-white" data-bs-dismiss="modal"></button>
            </div>
            <div class="modal-body">
                <div class="mb-3">
                    <h6 class="text-muted">Endpoint</h6>
                    <div class="input-group">
                        <input type="text" class="form-control font-monospace" id="apiEndpoint" readonly>
                        <button class="btn btn-outline-secondary" onclick="copyToClipboard('apiEndpoint')">
                            <i class="bi bi-clipboard"></i> Copy
                        </button>
                    </div>
                </div>

                <div class="mb-3">
                    <h6 class="text-muted">cURL Example</h6>
                    <pre class="bg-light p-3 rounded"><code id="curlExample"></code></pre>
                    <button class="btn btn-sm btn-outline-primary" onclick="copyToClipboard('curlExample')">
                        <i class="bi bi-clipboard"></i> Copy cURL
                    </button>
                </div>

                <div class="mb-3">
                    <h6 class="text-muted">JavaScript Fetch Example</h6>
                    <pre class="bg-light p-3 rounded"><code id="fetchExample"></code></pre>
                    <button class="btn btn-sm btn-outline-primary" onclick="copyToClipboard('fetchExample')">
                        <i class="bi bi-clipboard"></i> Copy JavaScript
                    </button>
                </div>

                <div class="mb-3">
                    <h6 class="text-muted">Python Requests Example</h6>
                    <pre class="bg-light p-3 rounded"><code id="pythonExample"></code></pre>
                    <button class="btn btn-sm btn-outline-primary" onclick="copyToClipboard('pythonExample')">
                        <i class="bi bi-clipboard"></i> Copy Python
                    </button>
                </div>
            </div>
        </div>
    </div>
</div>

<style>
    .stat-card {
        transition: transform 0.2s;
    }
    
    .stat-card:hover {
        transform: translateY(-5px);
    }

    .pagination {
        margin-bottom: 0;
    }
    
    .dataTables_info {
        padding-top: 0.5rem;
        font-size: 0.875rem;
        color: #6c757d;
    }
    
    .table thead th {
        position: sticky;
        top: 0;
        background-color: #f8f9fa;
        z-index: 10;
    }
    
    .tool-row.hidden {
        display: none;
    }
    
    .details-row.hidden {
        display: none;
    }
    
    th[onclick] {
        user-select: none;
    }
    
    th[onclick]:hover {
        background-color: #e9ecef;
    }
    
    .expand-btn {
        transition: transform 0.2s;
    }
    
    .expand-btn.expanded i {
        transform: rotate(180deg);
    }
    
    pre code {
        font-size: 0.85rem;
    }
    
    .font-monospace {
        font-family: 'Courier New', monospace;
    }
</style>

<script>
// ============================================================================
// GLOBAL VARIABLES
// ============================================================================
const toolData = {{ tool_details|tojson }};
let currentPage = 1;
let rowsPerPage = 50;
let allRows = [];
let filteredRows = [];
let sortColumn = -1;
let sortAscending = true;

// ============================================================================
// INITIALIZATION
// ============================================================================
$(document).ready(function() {
    allRows = Array.from(document.querySelectorAll('.tool-row'));
    filteredRows = [...allRows];
    updateTable();
    
    // Event listeners
    $('#rowsPerPage').on('change', function() {
        rowsPerPage = this.value === 'all' ? filteredRows.length : parseInt(this.value);
        currentPage = 1;
        updateTable();
    });
    
    $('#toolSearch').on('keyup', function() {
        filterTable(this.value);
    });
});

// ============================================================================
// FILTER TABLE
// ============================================================================
function filterTable(searchTerm) {
    searchTerm = searchTerm.toLowerCase().trim();
    
    if (searchTerm === '') {
        filteredRows = [...allRows];
    } else {
        filteredRows = allRows.filter(row => {
            const searchText = row.getAttribute('data-search-text');
            return searchText.includes(searchTerm);
        });
    }
    
    currentPage = 1;
    updateTable();
    
    // Show/hide filtered info
    if (filteredRows.length < allRows.length) {
        $('#filteredInfo').show();
        $('#totalTools').text(allRows.length);
    } else {
        $('#filteredInfo').hide();
    }
}

// ============================================================================
// CLEAR SEARCH
// ============================================================================
function clearSearch() {
    $('#toolSearch').val('');
    filterTable('');
}

// ============================================================================
// SORT TABLE
// ============================================================================
function sortTable(columnIndex) {
    if (columnIndex === 0) return; // Skip expand button column
    
    // Toggle sort direction if same column
    if (sortColumn === columnIndex) {
        sortAscending = !sortAscending;
    } else {
        sortColumn = columnIndex;
        sortAscending = true;
    }
    
    filteredRows.sort((a, b) => {
        let aValue, bValue;
        
        if (columnIndex === 3 || columnIndex === 4) {
            // Numeric sort for Max Hits and Interval columns
            aValue = parseInt(a.cells[columnIndex].getAttribute('data-sort-value')) || 0;
            bValue = parseInt(b.cells[columnIndex].getAttribute('data-sort-value')) || 0;
        } else {
            // Text sort
            aValue = a.cells[columnIndex].textContent.trim().toLowerCase();
            bValue = b.cells[columnIndex].textContent.trim().toLowerCase();
        }
        
        if (aValue < bValue) return sortAscending ? -1 : 1;
        if (aValue > bValue) return sortAscending ? 1 : -1;
        return 0;
    });
    
    currentPage = 1;
    updateTable();
}

// ============================================================================
// UPDATE TABLE
// ============================================================================
function updateTable() {
    const tbody = document.getElementById('toolsTableBody');
    const totalRows = filteredRows.length;
    
    // Calculate pagination
    const startIndex = (currentPage - 1) * rowsPerPage;
    const endIndex = rowsPerPage === totalRows ? totalRows : Math.min(startIndex + rowsPerPage, totalRows);
    
    // Hide all rows first
    allRows.forEach(row => {
        row.classList.add('hidden');
        // Also hide corresponding details row
        const detailsRow = row.nextElementSibling;
        if (detailsRow && detailsRow.classList.contains('details-row')) {
            detailsRow.classList.add('hidden');
        }
    });
    
    // Show only rows for current page
    for (let i = startIndex; i < endIndex; i++) {
        filteredRows[i].classList.remove('hidden');
        // Also show details row if it was expanded
        const detailsRow = filteredRows[i].nextElementSibling;
        if (detailsRow && detailsRow.classList.contains('details-row')) {
            detailsRow.classList.remove('hidden');
        }
    }
    
    // Reorder rows in tbody
    filteredRows.forEach(row => {
        tbody.appendChild(row);
        // Move details row too
        const detailsRow = row.nextElementSibling;
        if (detailsRow && detailsRow.classList.contains('details-row')) {
            tbody.appendChild(detailsRow);
        }
    });
    
    // Update info text
    $('#totalEntries').text(totalRows);
    $('#showingStart').text(totalRows === 0 ? 0 : startIndex + 1);
    $('#showingEnd').text(endIndex);
    
    // Update pagination
    updatePagination(totalRows);
}

// ============================================================================
// UPDATE PAGINATION
// ============================================================================
function updatePagination(totalRows) {
    const totalPages = Math.ceil(totalRows / rowsPerPage);
    const pagination = document.getElementById('pagination');
    pagination.innerHTML = '';
    
    if (totalPages <= 1) {
        return;
    }
    
    // Previous button
    const prevLi = document.createElement('li');
    prevLi.className = `page-item ${currentPage === 1 ? 'disabled' : ''}`;
    prevLi.innerHTML = `<a class="page-link" href="#" onclick="changePage(${currentPage - 1}); return false;">
        <i class="bi bi-chevron-left"></i>
    </a>`;
    pagination.appendChild(prevLi);
    
    // Page numbers
    const maxPagesToShow = 5;
    let startPage = Math.max(1, currentPage - Math.floor(maxPagesToShow / 2));
    let endPage = Math.min(totalPages, startPage + maxPagesToShow - 1);
    
    if (endPage - startPage < maxPagesToShow - 1) {
        startPage = Math.max(1, endPage - maxPagesToShow + 1);
    }
    
    // First page
    if (startPage > 1) {
        const firstLi = document.createElement('li');
        firstLi.className = 'page-item';
        firstLi.innerHTML = `<a class="page-link" href="#" onclick="changePage(1); return false;">1</a>`;
        pagination.appendChild(firstLi);
        
        if (startPage > 2) {
            const ellipsisLi = document.createElement('li');
            ellipsisLi.className = 'page-item disabled';
            ellipsisLi.innerHTML = `<a class="page-link" href="#">...</a>`;
            pagination.appendChild(ellipsisLi);
        }
    }
    
    // Page numbers
    for (let i = startPage; i <= endPage; i++) {
        const li = document.createElement('li');
        li.className = `page-item ${i === currentPage ? 'active' : ''}`;
        li.innerHTML = `<a class="page-link" href="#" onclick="changePage(${i}); return false;">${i}</a>`;
        pagination.appendChild(li);
    }
    
    // Last page
    if (endPage < totalPages) {
        if (endPage < totalPages - 1) {
            const ellipsisLi = document.createElement('li');
            ellipsisLi.className = 'page-item disabled';
            ellipsisLi.innerHTML = `<a class="page-link" href="#">...</a>`;
            pagination.appendChild(ellipsisLi);
        }
        
        const lastLi = document.createElement('li');
        lastLi.className = 'page-item';
        lastLi.innerHTML = `<a class="page-link" href="#" onclick="changePage(${totalPages}); return false;">${totalPages}</a>`;
        pagination.appendChild(lastLi);
    }
    
    // Next button
    const nextLi = document.createElement('li');
    nextLi.className = `page-item ${currentPage === totalPages ? 'disabled' : ''}`;
    nextLi.innerHTML = `<a class="page-link" href="#" onclick="changePage(${currentPage + 1}); return false;">
        <i class="bi bi-chevron-right"></i>
    </a>`;
    pagination.appendChild(nextLi);
}

// ============================================================================
// CHANGE PAGE
// ============================================================================
function changePage(page) {
    const totalPages = Math.ceil(filteredRows.length / rowsPerPage);
    if (page < 1 || page > totalPages) return;
    
    currentPage = page;
    updateTable();
    
    document.getElementById('toolsTable').scrollIntoView({ behavior: 'smooth', block: 'start' });
}

// ============================================================================
// TOGGLE DETAILS
// ============================================================================
function toggleDetails(button) {
    const row = button.closest('tr');
    const detailsRow = row.nextElementSibling;
    
    if (detailsRow && detailsRow.classList.contains('details-row')) {
        const isVisible = detailsRow.style.display !== 'none';
        detailsRow.style.display = isVisible ? 'none' : 'table-row';
        
        // Update button icon
        const icon = button.querySelector('i');
        if (isVisible) {
            icon.classList.remove('bi-chevron-up');
            icon.classList.add('bi-chevron-down');
            button.classList.remove('expanded');
        } else {
            icon.classList.remove('bi-chevron-down');
            icon.classList.add('bi-chevron-up');
            button.classList.add('expanded');
        }
    }
}

// ============================================================================
// TOGGLE ALL DETAILS
// ============================================================================
function toggleAllDetails() {
    const allDetailsRows = document.querySelectorAll('.details-row:not(.hidden)');
    const allButtons = document.querySelectorAll('.expand-btn');
    
    // Check if any are expanded
    const anyExpanded = Array.from(allDetailsRows).some(row => row.style.display === 'table-row');
    
    allDetailsRows.forEach(row => {
        row.style.display = anyExpanded ? 'none' : 'table-row';
    });
    
    allButtons.forEach(button => {
        const icon = button.querySelector('i');
        if (anyExpanded) {
            icon.classList.remove('bi-chevron-up');
            icon.classList.add('bi-chevron-down');
            button.classList.remove('expanded');
        } else {
            icon.classList.remove('bi-chevron-down');
            icon.classList.add('bi-chevron-up');
            button.classList.add('expanded');
        }
    });
}

// ============================================================================
// SHOW API INFO
// ============================================================================
function showAPIInfo(toolName) {
    $('#apiToolName').text(toolName);
    
    const baseUrl = window.location.origin;
    const endpoint = `${baseUrl}/api/tool/${toolName}/call`;
    $('#apiEndpoint').val(endpoint);
    
    // cURL example
    const curlExample = `curl -X POST "${endpoint}" \\
  -H "Content-Type: application/json" \\
  -H "Cookie: session=YOUR_SESSION_COOKIE" \\
  -d '{
    "method": "method_name",
    "arguments": {
      "param1": "value1"
    }
  }'`;
    $('#curlExample').text(curlExample);
    
    // JavaScript Fetch example
    const fetchExample = `fetch('${endpoint}', {
  method: 'POST',
  headers: {
    'Content-Type': 'application/json'
  },
  credentials: 'include',
  body: JSON.stringify({
    method: 'method_name',
    arguments: {
      param1: 'value1'
    }
  })
})
.then(response => response.json())
.then(data => console.log(data))
.catch(error => console.error('Error:', error));`;
    $('#fetchExample').text(fetchExample);
    
    // Python example
    const pythonExample = `import requests

url = "${endpoint}"
headers = {
    "Content-Type": "application/json"
}
data = {
    "method": "method_name",
    "arguments": {
        "param1": "value1"
    }
}

session = requests.Session()
# Login first to get session cookie
# session.post(login_url, json=credentials)

response = session.post(url, json=data, headers=headers)
print(response.json())`;
    $('#pythonExample').text(pythonExample);
    
    $('#apiInfoModal').modal('show');
}

// ============================================================================
// COPY FUNCTIONS
// ============================================================================
function copyToClipboard(elementId) {
    const element = document.getElementById(elementId);
    const text = element.tagName === 'INPUT' ? element.value : element.textContent;
    
    navigator.clipboard.writeText(text).then(() => {
        // Show temporary success message
        const btn = event.target.closest('button');
        const originalHTML = btn.innerHTML;
        btn.innerHTML = '<i class="bi bi-check"></i> Copied!';
        btn.classList.add('btn-success');
        
        setTimeout(() => {
            btn.innerHTML = originalHTML;
            btn.classList.remove('btn-success');
        }, 2000);
    });
}

function copyConfig(toolName) {
    const tool = toolData.find(t => t.name === toolName);
    if (tool) {
        const json = JSON.stringify(tool, null, 2);
        navigator.clipboard.writeText(json).then(() => {
            alert('Configuration copied to clipboard!');
        });
    }
}

function downloadConfig(toolName) {
    const tool = toolData.find(t => t.name === toolName);
    if (tool) {
        const json = JSON.stringify(tool, null, 2);
        const blob = new Blob([json], { type: 'application/json' });
        const url = URL.createObjectURL(blob);
        const a = document.createElement('a');
        a.href = url;
        a.download = `${toolName}_config.json`;
        a.click();
        URL.revokeObjectURL(url);
    }
}

function exportToJSON() {
    const json = JSON.stringify(toolData, null, 2);
    const blob = new Blob([json], { type: 'application/json' });
    const url = URL.createObjectURL(blob);
    const a = document.createElement('a');
    a.href = url;
    a.download = 'tools_configuration.json';
    a.click();
    URL.revokeObjectURL(url);
}

function copyTableToClipboard() {
    const table = document.getElementById('toolsTable');
    const rows = Array.from(table.querySelectorAll('tr:not(.details-row)'));
    
    let text = '';
    rows.forEach(row => {
        const cells = Array.from(row.querySelectorAll('th, td'));
        const rowText = cells.slice(1, -1).map(cell => cell.textContent.trim()).join('\t');
        if (rowText) text += rowText + '\n';
    });
    
    navigator.clipboard.writeText(text).then(() => {
        alert('Table copied to clipboard!');
    });
}

// ============================================================================
// UTILITY FUNCTIONS
// ============================================================================
function refreshPage() {
    window.location.reload();
}

function reloadAllTools() {
    if (!confirm('Are you sure you want to reload all tools?')) return;
    
    $.post('/api/admin/reload-all-tools')
        .done(function(data) {
            alert(data.message);
            refreshPage();
        })
        .fail(function(xhr) {
            alert('Error: ' + (xhr.responseJSON?.error || 'Failed to reload tools'));
        });
}
</script>
{% endblock %}